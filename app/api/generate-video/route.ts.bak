export const runtime = "nodejs";

/**
 * D√©mo: renvoie une URL vid√©o publique (placeholder)
 * + une l√©gende g√©n√©r√©e √† partir des champs news + refinements.
 */
export async function POST(req: Request) {
  try {
    const body = await req.json();
  if (body.article && !body.news) body.news = body.article; // compat ancien client
    const news = body?.news;
    const ref = body?.refinement;

    const title = news?.title || "Vid√©o g√©n√©r√©e (d√©mo)";
    const angle = news?.angle || "Angle g√©n√©rique";
    const hook = ref?.hook ? `üéØ ${ref.hook}` : "üéØ D√©couvrez en 60s";
    const cta = ref?.cta || "Passez en Fast Marketing avec KeiroAI";
    const tags = "#KeiroAI #Marketing #Video";

    // Petite vid√©o libre de test (placeholder)
    const videoUrl = "https://filesamples.com/samples/video/mp4/sample_640x360.mp4";

    const caption = `Actu : ${title}\nAngle : ${angle}\n\n${hook}\n${cta}\n\n${tags}`;
    return Response.json({ ok: true, videoUrl, caption });
  } catch (e: any) {
    return new Response(JSON.stringify({ ok: false, error: e.message }), {
      status: 500, headers: { "Content-Type": "application/json" },
    });
  }
}
